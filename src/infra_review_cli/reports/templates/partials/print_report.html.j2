<section id="print-report" class="print-report">
    <div class="print-cover">
        <h1>Infra Review — AWS Audit Report</h1>
        <div class="print-report-id-wrap">
            <!-- 
              Report ID format: IR-[ACCOUNT]-[DATE]-[TIME]
              Engineers: reference this ID in Jira/Linear tickets.
              Re-run the CLI after fixes and compare Report IDs to track improvement.
              Score trends: Security 0→45 between IR-196023-20260225 and IR-196023-20260301
            -->
            <span class="print-report-id">Report ID: <span id="print-report-id-value">{{ report_id }}</span></span>
        </div>

        <div class="print-meta-grid">
            <div><strong>AWS Account ID:</strong> {{ account_id }}</div>
            <div><strong>Region:</strong> {{ region }}</div>
            <div><strong>Scan date/time:</strong> {{ generated_at }}</div>
            <div><strong>Generated by:</strong> Infra Review CLI v<span id="print-app-version">{{ app_version }}</span></div>
            <div><strong>Scan duration:</strong> <span id="print-scan-duration">{{ scan_duration }}</span></div>
        </div>
    </div>

    {% set overall_status = 'GOOD' if overall_score >= 75 else ('NEEDS ATTENTION' if overall_score >= 50 else 'AT RISK') %}

    <section class="print-summary-block">
        <h2>Overall Score Summary</h2>
        <p><strong>Overall score:</strong> {{ overall_score }}/100 ({{ overall_status }})</p>
        <p><strong>Total estimated monthly savings:</strong> ${{ '%.2f'|format(monthly_savings) }}</p>
        <p><strong>Scan timestamp:</strong> {{ generated_at }}</p>

        <table class="print-summary-table">
            <thead>
                <tr>
                    <th>Pillar</th>
                    <th>Score</th>
                    <th>Status</th>
                    <th>Findings</th>
                    <th>Critical</th>
                    <th>High</th>
                </tr>
            </thead>
            <tbody>
                {% for p in pillars %}
                <tr>
                    <td>{{ p.name }}</td>
                    <td>{{ p.score_display }}{% if p.scanned %}/100{% endif %}</td>
                    <td>{{ p.status }}</td>
                    <td>{{ p.findings_count }}</td>
                    <td>{{ p.critical_count }}</td>
                    <td>{{ p.high_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <section class="print-summary-block print-scoring-reference">
        <h2>How your score is calculated</h2>
        <p>
            Each pillar starts at 100. Points are deducted for every failed check based on severity.
            Your overall score is the weighted average across all pillars.
        </p>
        <table class="print-summary-table">
            <thead>
                <tr>
                    <th>Severity</th>
                    <th>Points Deducted</th>
                    <th>What it means</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Critical</td><td>-25 pts</td><td>Immediate action required</td></tr>
                <tr><td>High</td><td>-15 pts</td><td>Address within days</td></tr>
                <tr><td>Medium</td><td>-8 pts</td><td>Address within weeks</td></tr>
                <tr><td>Low</td><td>-3 pts</td><td>Address when possible</td></tr>
            </tbody>
        </table>
        <p>Pillars with 0 checks run (NOT SCANNED) are excluded from the overall score.</p>
        <p>A score of 75+ is Good · 50-74 is Needs Attention · Below 50 is At Risk.</p>
    </section>

    <section class="print-findings-block">
        <h2>Findings</h2>
        {% for p in pillars %}
        {% set pillar_findings = findings | selectattr('pillar', 'equalto', p.name) | list %}
        {% if pillar_findings %}
        <article class="print-pillar-group">
            <h3>{{ p.name }}</h3>
            <table class="print-findings-table">
                <thead>
                    <tr>
                        <th>Finding ID</th>
                        <th>Resource</th>
                        <th>Region</th>
                        <th>Pillar</th>
                        <th>Finding Title</th>
                        <th>Description</th>
                        <th>Severity</th>
                        <th>Remediation</th>
                        <th>Estimated Savings</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for f in pillar_findings %}
                    <tr>
                        <td>{{ f.finding_ref_id }}</td>
                        <td class="mono">{{ f.resource_id }}</td>
                        <td>{{ f.region }}</td>
                        <td>{{ f.pillar }}</td>
                        <td>{{ f.title }}</td>
                        <td>{{ f.description | striptags }}</td>
                        <td>{{ f.severity }}</td>
                        <td>{{ f.remediation | striptags }}</td>
                        <td>{% if f.estimated_savings and f.estimated_savings > 0 %}${{ '%.2f'|format(f.estimated_savings) }}{% else %}-{% endif %}</td>
                        <td>{{ f.status }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </article>
        {% endif %}
        {% endfor %}
    </section>

    <div class="print-page-footer">
        <span>Infra Review · Report ID: {{ report_id }} · Generated: {{ generated_at }}</span>
        <span>Re-run this scan after remediation to track score improvement</span>
        <span class="print-page-number"></span>
    </div>
</section>
